.container
  %h5 REVIEW YOUR ANSWERS AND EDIT IF NECESSARY
  %h5.spain REVISE SUS RESPUESTAS Y HAY CUALQUIER CAMBIO QUE SEA NECESARIO
  %hr
  - field_type_to_show = /review_show|checkbox|time/

  - @document.template.steps.each do |step|
    %div{ :id => "scroll_#{step.step_number}" }
    - next if @document.cant_render?(step) || step.document_answers.blank?

    .row
      .col-md-10
        %strong.new_roman= step.to_s(@document).split('<spain/>')[0].html_safe
        %strong.new_roman.spain= step.to_s(@document).split('<spain/>')[1].html_safe

      .col-md-2
        = link_to document_answer_path(@document, step.step_number, :review => true), :class => 'btn btn-default' do
          %span.new_roman Change /
          %span.new_roman.spain Cambiar

    .row
      .col-md-12
        %table{ :style => 'width: 80%; margin-left: 20px' }

          - last_toggle = nil
          - toggler_answer = nil
          - amount_index = 0
          - shown_answers = 0

          - answers = DocumentAnswer.sort(@document.answers.where(:template_step_id => step.id).to_a, step)
          - answers.each do |answer|
            - next if !answer.nil? && answer.field_type.match(/button/)

            / hr for amount
            - if answer.template_field.id == DocumentAnswer.sort(@document.answers.where(:template_step_id => step.id).to_a, step).first.template_field.id && answer.id != @document.answers.where(:template_step_id => step.id).order(:id).first.id
              %div
                %hr

            / Skip if answer not mentioned to show
            - next if answer.answer.nil? && !answer.template_field.field_type.match(field_type_to_show)
            / Toggler
            - if answer.template_field.toggle_id.present?
              - if last_toggle != answer.template_field.toggle_id
                - last_toggle = answer.template_field.toggle_id
                - toggler_answer = answer
              - if last_toggle == answer.template_field.toggle_id
                / Toggler check
                - if toggler_answer.answer.present? && !toggler_answer.answer.match(answer.template_field.toggle_option.presence || '') || answer.template_field.toggle_option.nil? && toggler_answer.answer == '0' && !toggler_answer.field_type.match(/review_show/)
                  / Show NO if no other answers
                  - if answer == answers.last && shown_answers == 0
                    %span.answer No
                  - next

            / Insert fullfiling
            - if answer.template_field.name.present? && answer.template_field.name.match(/<insert>/)
              - next if @document.looped_amount(step, answer.template_step.document_answers.where(:document_id => @document.id)) != @document.loop_amount(step) && !answer.template_step.amount_field_id.present?
              - amount_index += 1
            - answer_html_array = answer.to_html_array(amount_index)

            - if answer.template_field.field_type.match(/rev_inline/)
              %span &nbsp
            - else
              %div

            / Html printing
            - if answer.template_field.field_type.match(field_type_to_show) && answer.template_field.insert_place.nil?
              - shown_answers += 1
              / 38 step need change until we have this one:
              - if answer.answer == '0'
                %span.answer No
              - else
                %span.answer= answer_html_array[0].split('<spain/>')[0].try :html_safe
                %span.spain= answer_html_array[0].split('<spain/>')[1].try :html_safe

            - if !answer.template_field.field_type.match(/checkbox/)
              - shown_answers += 1
              %span.answer= answer.to_spain.try :html_safe

            - if answer.template_field.field_type.match(/rev_br/)
              %br
              %br
    .row
      %br
      %hr

  .row
    .col-md-6
      = link_to 'Generate PDF', generate_pdf_path(@document.id), :class => 'btn btn-default navbar-right'

:javascript
  if($("#scroll_#{params[:scroll]}").length > 0){
    $(window).scrollTop( $("#scroll_#{params[:scroll]}").position().top - 20 );
  }